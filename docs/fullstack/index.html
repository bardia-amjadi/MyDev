<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>My Dev - برنامه نویسی فول استک</title>

  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.rtl.min.css" rel="stylesheet" />
  <link href="../src/css/site.css" rel="stylesheet">
</head>
<body class="light-mode">

  <div data-include="../src/html/navbar.html"></div>


  <button id="darkModeToggle" aria-pressed="false" aria-label="تغییر حالت روشن / تاریک">
    حالت تاریک
  </button>

  <aside id="sidebar" class="p-3">
    <h5 class="mb-3">فهرست مطالب</h5>
    <ul class="nav flex-column">
    <!-- داکر -->
    <li class="nav-item">
      <a class="nav-link fw-bold tree-toggle" data-bs-toggle="collapse" href="#docker-section" role="button" aria-expanded="false" aria-controls="docker-section">
        🐳 داکر
      </a>
      <ul class="collapse list-unstyled ps-3" id="docker-section">
        <li><a class="nav-link sidebar-link" href="#docker-intro">معرفی</a></li>
        <li><a class="nav-link sidebar-link" href="#docker-dockerfile">فایل Docker</a></li>
        <li><a class="nav-link sidebar-link" href="#docker-compose-file">فایل Docker Compose</a></li>
        <li><a class="nav-link sidebar-link" href="#docker-commands">دستورات</a></li>
      </ul>
    </li>

    <!-- محیط توسعه -->
    <li class="nav-item mt-3">
      <a class="nav-link fw-bold tree-toggle" data-bs-toggle="collapse" href="#vs-section" role="button" aria-expanded="false" aria-controls="backend-section">
        🧷 محیط توسعه
      </a>
      <ul class="collapse list-unstyled ps-3" id="vs-section">
        <li><a class="nav-link sidebar-link" href="#vs-folder">باز کردن یک پوشه</a></li>
        <li><a class="nav-link sidebar-link" href="#vs-termianl">استفاده از ترمینال</a></li>
      </ul>
    </li>

    <!-- بک‌اند -->
    <li class="nav-item mt-3">
      <a class="nav-link fw-bold tree-toggle" data-bs-toggle="collapse" href="#backend-section" role="button" aria-expanded="false" aria-controls="backend-section">
        ⚙️ بک‌اند
      </a>
      <ul class="collapse list-unstyled ps-3" id="backend-section">
        <li><a class="nav-link sidebar-link" href="#backend-create">طریقه ساخت</a></li>
        <li><a class="nav-link sidebar-link" href="#backend-docker-connection">اتصال به داکر</a></li>
        <li><a class="nav-link sidebar-link" href="#backend-migrate">Migrate</a></li>
        <li><a class="nav-link sidebar-link" href="#backend-auto-migrate">Auto Migrate</a></li>
        <li><a class="nav-link sidebar-link" href="#backend-manual-migrate">Manual Migrate</a></li>
      </ul>
    </li>

    <!-- دیتابیس -->
    <li class="nav-item mt-3">
      <a class="nav-link fw-bold tree-toggle" data-bs-toggle="collapse" href="#database-section" role="button" aria-expanded="false" aria-controls="database-section">
        🗄️ دیتابیس
      </a>
      <ul class="collapse list-unstyled ps-3" id="database-section">
        <li><a class="nav-link sidebar-link" href="#database-docker-connection">اتصال به داکر</a></li>
        <li><a class="nav-link sidebar-link" href="#database-add-dependencies">اضافه کردن Dependencies</a></li>
        <li><a class="nav-link sidebar-link" href="#database-mssql-connection">اتصال از طریق SQL Server Management</a></li>
      </ul>
    </li>

    <!-- فرانت‌اند -->
    <li class="nav-item mt-3">
      <a class="nav-link fw-bold tree-toggle" data-bs-toggle="collapse" href="#frontend-section" role="button" aria-expanded="false" aria-controls="frontend-section">
        🎨 فرانت‌اند
      </a>
      <ul class="collapse list-unstyled ps-3" id="frontend-section">
        <li><a class="nav-link sidebar-link" href="#frontend-create-project">ساخت پروژه</a></li>
        <li><a class="nav-link sidebar-link" href="#frontend-add-to-docker">اضافه کردن به داکر</a></li>
      </ul>
    </li>

    <li class="nav-item mt-3">
      <a class="nav-link fw-bold tree-toggle" data-bs-toggle="collapse" href="#others-section" role="button" aria-expanded="false" aria-controls="frontend-section">
        نکات تکمیلی
      </a>
      <ul class="collapse list-unstyled ps-3" id="others-section">
        <li><a class="nav-link sidebar-link" href="#tips-server">نکته درباره سرور</a></li>
        <li><a class="nav-link sidebar-link" href="#tips-appsettings">فایل Appsettings.json</a></li>
      </ul>
    </li>
    </ul>
  </aside>


  <main id="content" tabindex="-1">

  <section id="" tabindex="0">
    <h2>نکته</h2>
    <p class="txt txt-danger">برای استفاده بهتر صفحه را از دستکتاپ باز کنید</p>
  </section>

  <section id="docker-intro" tabindex="0">
    <h2>داکر - معرفی</h2>
    <p>داکر یه نرم‌افزاره که کمک می‌کنه برنامه‌ها رو داخل بسته‌های کوچیک و مستقل به اسم کانتینر اجرا کنیم. این کانتینرها مثل یه جعبه‌ست که همه چیزهای لازم برای اجرای برنامه (کد، کتابخونه، تنظیمات) رو داره. با داکر برنامه‌ها روی هر سیستمی بدون دردسر اجرا می‌شن، چون محیطشون همیشه ثابته. این باعث می‌شه توسعه و نصب برنامه‌ها راحت‌تر و سریع‌تر بشه. خلاصه‌ش: داکر برنامه‌ها رو قابل حمل و مستقل می‌کنه.</p>
    <figure class="text-center my-4">
      <a href="#" data-bs-toggle="modal" data-bs-target="#imageModal" data-img-src="../src/img/docker-desktop.png">
        <img src="../src/img/docker-desktop.png" alt="داکر دستکتاپ" class="img-fluid rounded shadow" style="max-width: 100%; height: auto; cursor: zoom-in;">
      </a>
      <figcaption class="mt-2 text-muted">شکل 1 : تصویری از Docker Desktop</figcaption>
    </figure>

  </section>

  <section id="docker-dockerfile" tabindex="0">
    <h2>داکر - فایل docker</h2>
    <p>فایل داکر (Dockerfile) یه فایل متنی ساده‌ست که دستورالعمل‌های ساخت یک تصویر (Image) داکر رو داره.<br/>
    داخلش می‌نویسیم:</p>
    <ul>
      <li>پایه‌ی تصویر چیه (مثلاً سیستم‌عامل یا زبان برنامه‌نویسی)</li>
      <li>چه برنامه‌ها یا کتابخونه‌هایی باید نصب بشن</li>
      <li>کد برنامه کجا کپی بشه</li>
      <li>چه دستوری موقع اجرای کانتینر اجرا بشه</li>
    </ul>
    <p>با استفاده از این فایل، داکر می‌تونه تصویر برنامه رو خودکار بسازه و هر جا خواستیم اجراش کنیم. خلاصه: Dockerfile راهنمای ساخت تصویر برای اجرای برنامه‌ست.</p>
    <figure class="text-center my-4">
      <a href="#" data-bs-toggle="modal" data-bs-target="#imageModal" data-img-src="../src/img/dockerfile.png">
        <img src="../src/img/dockerfile.png" alt="فایل داکر" class="img-fluid rounded shadow" style="max-width: 100%; height: auto; cursor: zoom-in;">
      </a>
      <figcaption class="mt-2 text-muted">شکل 2 : تصویری از کد داخل فایل داکر</figcaption>
    </figure>
  </section>

  <section id="docker-compose-file" tabindex="0">
    <h2>داکر - فایل docker-compose</h2>
    <p>فایل Docker Compose یه فایل متنی با فرمت YAML هست که برای مدیریت چند تا کانتینر داکر با هم استفاده می‌شه.<br/>
    توی این فایل تعریف می‌کنیم که هر کانتینر چیه، چه تصویری باید اجرا بشه، چه پورت‌هایی باز باشن، چطوری با هم شبکه‌سازی کنن و چه تنظیماتی داشته باشن.<br/>
    به کمک Docker Compose می‌تونیم کل سیستم یا پروژه‌ای که شامل چند سرویسه رو با یک دستور ساده اجرا، متوقف یا مدیریت کنیم.<br/>
    خلاصه: فایل Docker Compose تنظیمات چند کانتینر و نحوه کارکردشون رو در یکجا جمع می‌کنه.</p>
    <figure class="text-center my-4">
      <a href="#" data-bs-toggle="modal" data-bs-target="#imageModal" data-img-src="../src/img/docker-compose.png">
        <img src="../src/img/docker-compose.png" alt="فایل داکر کامپوز" class="img-fluid rounded shadow" style="max-width: 100%; height: auto; cursor: zoom-in;">
      </a>
      <figcaption class="mt-2 text-muted">شکل 3 : تصویری از فایل Docker Compose</figcaption>
    </figure>
  </section>

  <section id="docker-commands" tabindex="0">
    <h2>داکر - دستورات</h2>
    <p>این‌ها دستورات مهم و پرکاربرد Docker Compose هستن که معمولاً استفاده می‌شن:</p>
    <ul>
      <li><code>docker-compose up</code><br/> همه سرویس‌ها رو اجرا می‌کنه (اگه تصویر موجود نباشه، می‌سازه).</li>
      <li><code>docker-compose up -d</code><br/> سرویس‌ها رو در پس‌زمینه (Detached mode) اجرا می‌کنه.</li>
      <li><code>docker-compose down</code><br/> همه کانتینرها، شبکه‌ها و منابع ساخته شده توسط Compose رو متوقف و حذف می‌کنه.</li>
      <li><code>docker-compose build</code><br/> تصاویر داکر رو طبق Dockerfile ها می‌سازه.</li>
      <li><code>docker-compose stop</code><br/> فقط کانتینرها رو متوقف می‌کنه، حذف نمی‌کنه.</li>
      <li><code>docker-compose restart</code><br/> کانتینرها رو ریستارت می‌کنه.</li>
      <li><code>docker-compose logs</code><br/> لاگ خروجی کانتینرها رو نمایش می‌ده.</li>
      <li><code>docker-compose ps</code><br/> لیست کانتینرهای در حال اجرا رو نشون می‌ده.</li>
    </ul>
    <p>این‌ها پایه‌ای‌ترین‌ها هستن که هر روز باهاشون کار می‌کنیم.</p>
  </section>

   <section id="vs-folder" tabindex="0">
      <h2>محیط توسعه - بازکردن پوشه</h2>
      <p>خب ما قراره از vs code برای ویرایش این پروژه ها اتسفاده کنیم</p>
      <p>خب اول از همه نیازه که ما پروژه بک اند خودمون رو بسازیم بعدش حالا نیازه بریم پوشه اش رو برای workspace باز کنیم</p>
      <p>برای باز کردن پوشه</p>
      <ul>
        <li>وارد محیط Visual Studio Code میشیم</li>
        <li> روی  <code>File > Open Folder</code> کلیک میکنیم
          <figure class="text-center my-4">
            <img src="../src/img/open-folder.png" alt="باز کردن پوشه" class="img-fluid rounded shadow" style="max-width: 100%; height: auto;">
            <figcaption class="mt-2 text-muted">شکل 4 : باز کردن پوشه</figcaption>
          </figure>
        </li>
        <li>حالا کافیه اون پوشه ای که فایل سولوشن پروژه ما قرار دارو رو انتخاب کنیم
          <figure class="text-center my-4">
            <img src="../src/img/solution-open.png" alt="باز کردن پوشه" class="img-fluid rounded shadow" style="max-width: 100%; height: auto;">
            <br>
            <img src="../src/img/solution-folder.png" alt="باز کردن پوشه" class="img-fluid rounded shadow" style="max-width: 100%; height: auto;">
            <figcaption class="mt-2 text-muted">شکل 5 : باز کردن پوشه</figcaption>
        </figure>
        </li>
      </ul>
      <p>فعال کردن پشتیبانی داکر باعث می‌شود بتوانیم پروژه را داخل کانتینرهای داکر بسته‌بندی کنیم و در محیط‌های مختلف بدون مشکل اجرا کنیم.</p>
    </section>

    <section id="vs-terminal" tabindex="0">
      <h2>محیط توسعه - استفاده از ترمینال</h2>
      <ul>
        <li>برای باز کردن ترمینال کافیه بریم <code>Terminal > New Terminal</code>
          <figure class="text-center my-4">
            <img src="../src/img/open-terminal.png" alt="باز کردن پوشه" class="img-fluid rounded shadow" style="max-width: 100%; height: auto;">
            <figcaption class="mt-2 text-muted">شکل 4 : باز کردن پوشه</figcaption>
          </figure>
        </li>
        <li>در نهایت ترمینال باز میشه
          <figure class="text-center my-4">
            <img src="../src/img/terminal-example.png" alt="باز کردن پوشه" class="img-fluid rounded shadow" style="max-width: 100%; height: auto;">
            <figcaption class="mt-2 text-muted">شکل 4 : باز کردن پوشه</figcaption>
          </figure>
        </li>
      </ul>
      <p>فعال کردن پشتیبانی داکر باعث می‌شود بتوانیم پروژه را داخل کانتینرهای داکر بسته‌بندی کنیم و در محیط‌های مختلف بدون مشکل اجرا کنیم.</p>
    </section>


    <section id="backend-create" tabindex="0">
      <h2>بک اند - طریقه ساخت</h2>
      <p>برای ساخت بک اند:</p>
      <ul>
        <li>وارد محیط Visual Studio می‌شویم.</li>
        <li>یک پروژه ASP.NET Core API جدید می‌سازیم.
          <figure class="text-center my-4">
            <img src="../src/img/api-select.png" alt="جستوجو و انتخاب پروژه" class="img-fluid rounded shadow" style="max-width: 100%; height: auto;">
            <figcaption class="mt-2 text-muted">شکل 2 : جستوجو و انتخاب پروژه</figcaption>
          </figure>
        </li>
        <li>حتما تیک <code>Enable Docker Support</code> را می‌زنیم. این کار باعث می‌شود پروژه شما آماده اجرا در محیط داکر شود و فایل‌های لازم (مانند Dockerfile) به صورت خودکار ایجاد شوند.
        حتما هم نوع <code>container</code> رو روی <code>Windows</code> بزارید
          <figure class="text-center my-4">
            <img src="../src/img/Select-docker.png" alt="تنظمیات پروژه" class="img-fluid rounded shadow" style="max-width: 100%; height: auto;">
            <figcaption class="mt-2 text-muted">شکل 3 : تنظمیات پروژه</figcaption>
        </figure>
        </li>
      </ul>
      <p>فعال کردن پشتیبانی داکر باعث می‌شود بتوانیم پروژه را داخل کانتینرهای داکر بسته‌بندی کنیم و در محیط‌های مختلف بدون مشکل اجرا کنیم.</p>
    </section>

    <section id="backend-docker-connection" tabindex="0">
      <h2>بک اند - اتصال به داکر</h2>
      <p>برای اینکه پروژه ASP.NET Core API خود را داخل داکر اجرا کنیم، نیاز داریم یک فایل <code>docker-compose.yml</code> در پوشه سولوشن بسازیم و تنظیمات زیر را به آن اضافه کنیم:</p>
      <figure class="text-center my-4">
            <img src="../src/img/docker-compose-2.png" alt="داکر کامپوز" class="img-fluid rounded shadow" style="max-width: 100%; height: auto;">
            <figcaption class="mt-2 text-muted">شکل 6 : Docker Compose</figcaption>
          </figure>
      <pre><code>services:

networks:
  mynetwork:

volumes:
</code></pre>
      <p>در قسمت <code>services</code> هر پروژه یا سرویس که می‌خواهیم به داکر اضافه کنیم را تعریف می‌کنیم.</p>
      <p>در بخش <code>networks</code> یک شبکه با نام دلخواه مثلاً <code>mynetwork</code> می‌سازیم که کانتینرها بتوانند با هم ارتباط داشته باشند.</p>
      <p>مثال اضافه کردن پروژه <code>ProjectName</code>:</p>
      <figure class="text-center my-4">
            <img src="../src/img/docker-compose-3.png" alt="داکر کامپوز" class="img-fluid rounded shadow" style="max-width: 100%; height: auto;">
            <figcaption class="mt-2 text-muted">شکل 7 : Docker Compose</figcaption>
          </figure>
      <pre><code>services:
  {PrpjectName}:
    build:
      context: .
      dockerfile: {ProjectName}/Dockerfile
    environment:
      - ASPNETCORE_ENVIRONMENT=Development
    ports:
      - "8080:8080"
    networks:
      - mynetwork

networks:
  mynetwork:

volumes:
</code></pre>
      <p>با این کد پروژه <code>melkapi</code> به داکر اضافه می‌شود و پورت ۸۰۸۰ پروژه به پورت ۸۰۸۰ سیستم میزبان متصل می‌شود.</p>

      <p>اگر با ارور <code>dotnet run restore</code> مواجه شدید، ممکن است فایل <code>Dockerfile</code> به درستی تنظیم نشده باشد. محتوای استاندارد Dockerfile برای ASP.NET Core 8 به شکل زیر است:</p>
      <figure class="text-center my-4">
            <img src="../src/img/dockerfile-2.png" alt="داکر فایل" class="img-fluid rounded shadow" style="max-width: 100%; height: auto;">
            <figcaption class="mt-2 text-muted">شکل 8 : Dockerfile</figcaption>
          </figure>
      <pre><code># Base image
FROM mcr.microsoft.com/dotnet/aspnet:8.0 AS base
WORKDIR /app
EXPOSE 8080
EXPOSE 8081

# Build image
FROM mcr.microsoft.com/dotnet/sdk:8.0 AS build
ARG BUILD_CONFIGURATION=Release
WORKDIR /src
COPY ["{ProjectName}/{ProjectName}.csproj", "{ProjectName}/"]
RUN dotnet restore "{ProjectName}/{ProjectName}.csproj"
COPY . .
WORKDIR "/src/{ProjectName}"
RUN dotnet build "{ProjectName}.csproj" -c $BUILD_CONFIGURATION -o /app/build

# Publish image
FROM build AS publish
ARG BUILD_CONFIGURATION=Release
RUN dotnet publish "{ProjectName}.csproj" -c $BUILD_CONFIGURATION -o /app/publish /p:UseAppHost=false

# Final runtime image
FROM base AS final
WORKDIR /app
COPY --from=publish /app/publish .
ENTRYPOINT ["dotnet", "{ProjectName}.dll"]
</code></pre>

      <p>پس از تنظیم این فایل‌ها، پروژه شما قابل ساخت و اجرا داخل داکر است.</p>
    </section>
    <section id="backend-migrate" tabindex="0">
      <h2>بک اند - Migrate</h2>
      <p>این کد هنگام اجرای برنامه چند بار تلاش می‌کند تا مایگریشن‌ها را اعمال کند و اگر خطایی رخ دهد، با تأخیر دوباره امتحان می‌کند.</p>
      <p>برای نصب Entityframework کافیه دستور زیر رو توی کنسول تایپ کنید :</p>
      <pre><code>dotnet tool install --global dotnet-ef</code></pre>
      <p>برای ایجاد یک مایگریشن جدید، از دستور زیر در کنسول استفاده کنید:</p>
      <pre><code>dotnet ef migrations add {Name}</code></pre>
       <figure class="text-center my-4">
            <img src="../src/img/migration.png" alt="migration" class="img-fluid rounded shadow" style="max-width: 100%; height: auto;">
            <figcaption class="mt-2 text-muted">شکل 7 : مایگریشن</figcaption>
          </figure>  
    </section>

    <section id="backend-auto-migrate" tabindex="0">
      <h2>بک اند - طریقه ساخت Auto Migrate</h2>
      <p>برای اجرای خودکار مایگریشن‌های EF Core هنگام اجرای برنامه، کافی است در بخش middleware (معمولاً داخل <code>Program.cs</code> بعد از اتصال دیتابیس) این کد را اضافه کنیم:</p>
        <figure class="text-center my-4">
            <img src="../src/img/auto-migrate.png" alt="migrate" class="img-fluid rounded shadow" style="max-width: 100%; height: auto;">
            <figcaption class="mt-2 text-muted">شکل 7 : مایگریشن خودکار</figcaption>
          </figure> 
      <pre><code>int maxRetries = 15;
int delaySeconds = 5;

for (int i = 0; i &lt; maxRetries; i++)
{
    try
    {
        using var scope = app.Services.CreateScope();
        var db = scope.ServiceProvider.GetRequiredService&lt;AppDbContext&gt;();
        db.Database.Migrate();
        Console.WriteLine("Migration completed");
        break;
    }
    catch (Exception ex)
    {
        if (i == maxRetries - 1)
            Console.WriteLine($"Migration failed after retries: {ex}");
        System.Threading.Thread.Sleep(delaySeconds * 1000);
    }
}</code></pre>
      <p>و سپس پروژه را ری‌استارت کنید تا مایگریشن اعمال شود.</p>
    </section>

    <section id="backend-manual-migrate" tabindex="0">
      <h2>بک اند - طریقه ساخت Manual Migrate</h2>
      <p>این روش توصیه نمی‌شود ولی اگر بخواهید مایگریشن را به صورت دستی و از طریق یک API کنترل کنید، می‌توانید در یک کنترلر این متد را بسازید:</p>
          <figure class="text-center my-4">
            <img src="../src/img/manual-migrate.png" alt="migrate" class="img-fluid rounded shadow" style="max-width: 100%; height: auto;">
            <figcaption class="mt-2 text-muted">شکل 7 : مایگریشن دستی</figcaption>
          </figure> 
      <pre><code>[HttpGet("migrate")]
[Route("/options/migrate")]
public IActionResult MigrateDatabase()
{
    int maxRetries = 5;
    int delaySeconds = 5;

    for (int i = 0; i &lt; maxRetries; i++)
    {
        try
        {
            using var scope = HttpContext.RequestServices.CreateScope();
            var db = scope.ServiceProvider.GetRequiredService&lt;AppDbContext&gt;();
            db.Database.Migrate();
            return Ok("Migration completed");
        }
        catch (Exception ex)
        {
            if (i == maxRetries - 1)
                return StatusCode(500, $"Migration failed after retries: {ex}");
            System.Threading.Thread.Sleep(delaySeconds * 1000);
        }
    }
    return StatusCode(500, "Migration failed");
}</code></pre>
      <p>این متد یک API ارائه می‌دهد که با فراخوانی آن، مایگریشن‌ها اجرا می‌شوند.</p>
    </section>
     <section id="database-docker-connection" tabindex="0">
    <h2 class="mb-3">📦 اتصال دیتابیس به داکر</h2>
    <p>
      برای راه‌اندازی SQL Server در محیط داکر، تنها کافی است یک سرویس جدید در فایل <code>docker-compose.yml</code> تعریف شود. تنظیمات پیشنهادی به شکل زیر است:
    </p>
    <figure class="text-center my-4">
            <img src="../src/img/docker-compose-4.png" alt="docker compose" class="img-fluid rounded shadow" style="max-width: 100%; height: auto;">
            <figcaption class="mt-2 text-muted">شکل 7 : Docker Compose</figcaption>
          </figure> 
    <pre><code class="language-yaml">sqlserver:
  image: mcr.microsoft.com/mssql/server:2022-latest
  container_name: sqlserver
  environment:
    - ACCEPT_EULA=Y
    - SA_PASSWORD=P@ssw0rd2025!
  ports:
    - "1433:1433"
  networks:
    - mynetwork
  volumes:
    - sql_data:/var/opt/mssql
    - ./mssql.conf:/var/opt/mssql/mssql.conf:ro
  healthcheck:
    test: ["CMD-SHELL", "pidof sqlservr"]
    interval: 10s
    timeout: 5s
    retries: 10</code></pre>

    <p class="mt-3">
      توجه داشته باشید که مقادیر <code>container_name</code> (در اینجا: <code>sqlserver</code>) و <code>SA_PASSWORD</code> قابل شخصی‌سازی هستند و می‌توانند با مقادیر امن‌تر یا مناسب پروژه جایگزین شوند.
    </p>

    <p>
      همچنین، برای حفظ اطلاعات بین ری‌استارت‌ها، باید در انتهای فایل <code>docker-compose.yml</code> بخش volume را نیز اضافه کنیم:
    </p>
    <figure class="text-center my-4">
            <img src="../src/img/volums.png" alt="volumes" class="img-fluid rounded shadow" style="max-width: 100%; height: auto;">
            <figcaption class="mt-2 text-muted">شکل 7 : Volumes</figcaption>
          </figure> 
    <pre><code class="language-yaml">volumes:
  sql_data:</code></pre>
  </section>

  <!-- دیتابیس - اضافه کردن dependencies -->
  <section id="database-add-dependencies"  tabindex="0">
    <h2 class="mb-3">🔗 تنظیم وابستگی‌ها (Dependencies)</h2>
    <p>
      اگر پروژه را به‌صورت هم‌زمان با سرویس‌های Backend و SQL Server اجرا کنید، ممکن است Auto Migration در EF Core به دلیل آماده نبودن دیتابیس با خطا مواجه شود.
    </p>

    <p>
      برای حل این مشکل، می‌توان از ویژگی <code>depends_on</code> همراه با شرط <code>service_healthy</code> استفاده کرد تا اطمینان حاصل شود ابتدا دیتابیس آماده است و سپس Backend اجرا شود.
    </p>

    <p>
      همچنین ما باید توی همین قسمت ConnectionString رو هم بنویسیم
    </p>
    <p>کد زیر را به بخش backend در فایل <code>docker-compose.yml</code> اضافه کنید، دقیقاً بعد از <code>ports</code>:</p>
    <figure class="text-center my-4">
            <img src="../src/img/docker-compose-5.png" alt="docker compose" class="img-fluid rounded shadow" style="max-width: 100%; height: auto;">
            <figcaption class="mt-2 text-muted">شکل 7 : Docker Compose</figcaption>
          </figure> 
    <pre><code class="language-yaml">depends_on:
  sqlserver:
    condition: service_healthy</code></pre>

    <p>
      مقدار <code>sqlserver</code> باید با نام واقعی سرویس دیتابیس شما در فایل <code>docker-compose</code> مطابقت داشته باشد.
    </p>
  </section>

  <!-- دیتابیس - اتصال از طریق Microsoft SQL Server Management -->
  <section id="database-mssql-connection" tabindex="0">
    <h2 class="mb-3">🖥️ اتصال به SQL Server با استفاده از SSMS</h2>
    <p>
      برای اتصال به دیتابیس SQL Server از طریق نرم‌افزار Microsoft SQL Server Management Studio (SSMS)، کافیست اطلاعات اتصال را وارد کرده و مطمئن شوید گزینه <code>TrustServerCertificate</code> برابر با <code>true</code> تنظیم شده است.
    </p>

    <p>نمونه اطلاعات اتصال:</p>
    <ul>
      <li>Server: <code>localhost,1433</code></li>
      <li>Username: <code>sa</code></li>
      <li>Password: <code>P@ssw0rd2025!</code></li>
    </ul>

    <p>
      در تنظیمات پیشرفته اتصال (Advanced)، مقدار <code>TrustServerCertificate=true</code> را وارد کنید تا از بروز خطاهای مربوط به SSL جلوگیری شود.
    </p>

    <figure class="text-center my-4">
            <img src="../src/img/ssms-signin.png" alt="ssms signin" class="img-fluid rounded shadow" style="max-width: 100%; height: auto;">
            <figcaption class="mt-2 text-muted">شکل 7 : اتصال به سرور از ssms</figcaption>
          </figure>

          <figure class="text-center my-4">
            <img src="../src/img/ssms-connection.png" alt="ssms connection" class="img-fluid rounded shadow" style="max-width: 100%; height: auto;">
            <figcaption class="mt-2 text-muted">شکل 7 : فعال کردن TrustServerCertificate</figcaption>
          </figure>
  </section>

  <section id="tips-server" tabindex="0">
    <h2 class="mb-3">نکاتی درباره سرور</h2>
    <p>
      معمولا ارور هایی مثل ارور های زیر میبیند که هیچ مشکلی نداره و فقط مهمه که سرور شما کرش نکرده باشه 
      معمولا سرور ها خیلی طول میکشند که استاندارد بشند برای اتصال از طریق MSSM و Backend باید به سرور زمان بدیم
      حتی امکان اینکه healthcheck رو هم دور بزنند هست
    </p>
    <pre><code >Error: 18456, Severity: 14, State: 7.
2025-07-23 10:15:06.17 Logon       Login failed for user 'sa'. Reason: An error occurred while evaluating the password. [CLIENT: 172.18.0.3]
 </code></pre>
  </section>
  </main>

  <div class="modal fade" id="imageModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered modal-xl">
    <div class="modal-content bg-dark border-0">
      <div class="modal-body p-0 position-relative">
        <div class="zoom-container overflow-auto" style="max-height: 90vh;">
          <img id="modalImage" src="" class="zoom-image d-block mx-auto" style="max-width: 100%; transition: transform 0.3s ease;">
        </div>
        <button type="button" class="btn btn-light position-absolute top-0 end-0 m-3" data-bs-dismiss="modal" aria-label="بستن">×</button>
      </div>
    </div>
  </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  <script src="../src/js/sidebar.js"></script>
  <script src="../src/js/zoom.js"></script>
  <script src="../src/js/partail.js"></script>


</body>
</html>
